<p id="notice"><%= notice %></p>

<% if @game.game_is_done? then %>
  <% @game.finish_dealer_hand %>
<% end %>

<table class="table">
  <thead>
    <tr>
      <th colspan="3"></th>
    </tr>
  </thead>    
<tbody>
<% @game.users.order(:name).each do |user| %>
      <tr>
        <td><%= user.name %>'s hand:</td>
        <td>
        <% user.hand(@game).each do |card|%>
        <td><%= image_tag card['image'] %></td>
        <% end%>
        <%#add clause checking if user has "stand"ed already %>
        <% if (user.name.downcase == "dealer" && current_user.has_stood == false && @game.game_is_done? == false) %>
         <td> <%= image_tag "BackOfRedCard.png" , size: "233x320" %> </td>
        <% end %>
        <td><%= user.name %>'s hands value: <%= @game.value(user.hand(@game)) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @game.game_is_done? then %>
	<p> 
		The game is done!
    
    <% victor= @game.who_won  %>
    <% if victor then %>
		  The winner is: <%= victor.name %>
      <% victor.update_attribute(:wins, victor.wins+1)%>
      <% victor.update_attribute(:tokens, 5)%>
    <% else%>
      You both lost!
    <% end %>
	</p>
  <%= link_to "Play a new Game!", new_game_path, class: "btn btn-lg btn-success",  data: { disable_with: 'loading...' }%>

<% else %>
	<p> <%= @user.name %>, will you: </p>
  <ul>
  	<button type="button" class="btn btn-primary btn-lg">
    <%= link_to "Hit", hit_path, :method => :get,  data: { disable_with: 'loading...' } %>
    </button>
    <button type="button" class="btn btn-secondary btn-lg">
    <%= link_to "Stand", stand_path, :method => :get,  data: { disable_with: 'loading...' } %>
    </button>
  </ul>
<% end %>

